"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4327],{13521:function(e,t,l){l.d(t,{D:function(){return u}});var n=l(97458),a=l(52983);let r=(e,t,l)=>{(0,a.useEffect)(()=>{let n=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&t()})},l),a=e.current;return a&&n.observe(a),()=>{a&&n.unobserve(a)}},[e,t,l])};var s=l(10107),o=l(92497),i=l(77837),c=l.n(i);let u=e=>{let{children:t,fetchNextPage:l,hasNextPage:i,showLoadingState:u,itemsToRender:d}=e,m=(0,a.useRef)(l);m.current=l;let h=(0,a.useRef)(c()(()=>m.current(),300)),g=(0,a.useRef)(null);return r(g,h.current,{rootMargin:"50px",threshold:0}),(0,n.jsxs)(n.Fragment,{children:[t,u&&(0==d.length?(0,n.jsx)(s.ZP,{className:"py-sm",children:(0,n.jsx)(o.Z,{animateLines:!1,blockCount:12,divider:!0})}):(0,n.jsx)(s.ZP,{className:"py-md",children:(0,n.jsx)(o.Z,{animateLines:!1,blockCount:1})})),d.length>0&&i&&(0,n.jsx)("div",{ref:g,className:"border border-transparent"})]})}},80631:function(e,t,l){l.d(t,{W:function(){return i}});var n=l(97458),a=l(40853),r=l(52983),s=l(60971),o=l(46696);let i=r.memo(e=>(0,n.jsxs)("div",{className:"flex items-center  gap-x-xs",children:[(0,n.jsx)(s.Z,{variant:"tiny",color:"light",children:(0,n.jsx)(a.G,{size:"sm",icon:e.icon})}),(0,n.jsx)(s.Z,{variant:"tiny",color:"light",children:(0,o.uf)(e.count)})]}),(e,t)=>e.count===t.count&&e.icon===t.icon)},35546:function(e,t,l){var n=l(97458),a=l(52983),r=l(71485),s=l(16064),o=l(10785),i=l(80937),c=l(4028),u=l(33326),d=l(61904),m=l(62013),h=l(22055),g=l(45201),x=l(15116);t.Z=e=>{let{show:t,onDelete:l,onAddToCollection:v,onSwapCollection:p,onRemoveFromCollection:f,currentCollection:y,rwToken:j,type:w}=e,{isMobileStyle:N}=(0,m.d)(),k=null!==j,C=k&&(w===s.W.LIBRARY||w===s.W.SEARCH)&&null==y&&null!=v,[b,A]=(0,a.useState)(!1),I=(0,r.useTranslations)("threadItem"),Z=(0,r.useTranslations)("shared");if(!t)return null;let D=[{icon:i.r8,text:Z("addToCollection"),show:C,onClick:v,testId:"thread-add-to-collection"},{icon:c.a_,text:Z("swapCollections"),show:k&&null!=y&&null!=p,onClick:p,testId:"thread-swap-collection"},{icon:d.faXmark,text:Z("removeFromCollection"),show:k&&null!=f&&null!=y,onClick:f,testId:"thread-remove-from-collection"},{icon:u.$,text:I("deleteThread"),show:k&&null!=l,onClick:()=>A(!0),testId:"thread-delete"}];return(null==D?void 0:D.every(e=>!e.show))?null:(0,n.jsxs)("div",{children:[(0,n.jsx)(h.G,{items:D,isMobileStyle:N,children:(0,n.jsx)(g.Z,{testId:"thread-dropdown-menu",size:"small",icon:o.faEllipsis})}),(0,n.jsx)(x.Z,{isOpen:b,onClose:()=>A(!1),message:I("deleteThreadConfirmation"),actionList:[{text:Z("nevermind"),onClick:()=>A(!1)},{text:Z("confirm"),variant:"rejected",onClick:l}]})]})}},16064:function(e,t,l){l.d(t,{W:function(){return a},B:function(){return W}});var n,a,r=l(97458),s=l(52983),o=l(71485),i=l(43566),c=l.n(i),u=l(55110),d=l(10632),m=l(83777);let h=e=>{let{collections:t}=(0,m.l)();if(!e)return null;let l=null==t?void 0:t.find(t=>t.uuid===e);return null!=l?l:null};var g=l(71728),x=l(56047),v=l(93040),p=l(10505),f=l(68956),y=l(56934),j=l(35546),w=l(75103),N=l.n(w);let k=s.memo(e=>{let{type:t,featuredImage:l,title:n,href:s}=e;return l&&t===a.DISCOVER?(0,r.jsx)(c(),{href:s,children:(0,r.jsx)("div",{className:"relative h-24 w-24 flex-none overflow-hidden rounded-md",children:l.includes("images.unsplash.com")?(0,r.jsx)("img",{src:l,alt:n,className:"h-24 w-24 rounded-md object-cover"}):(0,r.jsx)(N(),{src:l,alt:n,sizes:"33vw",fill:!0,priority:!0,style:{objectFit:"cover"}})})}):null});var C=l(22388),b=l(17683),A=l(80631),I=l(51253),Z=l(49544),D=l(21850);let T=s.memo(e=>{var t,l;let{threadAccess:n,socialInfo:a}=e;if(!n||!a||n<D.uv.PUBLIC_READ)return null;let s=null!==(t=a.view_count)&&void 0!==t?t:0,o=null!==(l=a.fork_count)&&void 0!==l?l:0;return(0,r.jsxs)(r.Fragment,{children:[s>0&&(0,r.jsx)(A.W,{icon:Z.Md,count:s}),o>0&&(0,r.jsx)(A.W,{icon:I.MD,count:o})]})});var _=l(34957),S=l(31478);let Q=s.memo(e=>{let{threadCount:t,threadAccess:l,lastUpdated:n,socialInfo:a,assistant:s}=e,o=(0,b.k)();return(0,r.jsxs)("div",{className:"flex items-center gap-x-md",children:[!!t&&t>1&&(0,r.jsx)(A.W,{icon:_.Oq,count:t}),(0,r.jsx)(T,{socialInfo:a,threadAccess:l}),(0,r.jsx)(S.Z,{timestamp:n,translations:o}),(0,r.jsx)(C.Z,{textColor:"light",textVariant:"tiny",assistant:s})]})});var L=l(80937),R=l(10107),P=l(60971),E=l(45201);let O=e=>{let{title:t,preview:l,threadCount:n,lastUpdated:i,href:w="/",rwToken:N,assistant:C,socialInfo:b,showActionMenu:A=!0,authorImage:I,threadAccess:Z,type:D,featuredImage:T,entryUUID:_,collection:S}=e,O=h(null==S?void 0:S.uuid),{openModal:U}=(0,v.X)(),{collections:M}=(0,m.l)(),{searchTerm:W}=(0,p.p)(),{deleteThread:X}=(0,g.l)(),{removeThreadFromCollection:z}=(0,d.Fb)(),F=(0,u.useRouter)(),{trackEvent:q}=(0,x.WS)(),B=(0,o.useTranslations)("shared"),G=(0,s.useCallback)(e=>{let{entryUUID:t}=e;0===M.length?U("collectionCreateOrEdit",{existingCollection:O,frontendContextUUID:void 0,searchTerm:W}):U("collectionSelectModal",{entryUUID:t,userCollections:M,currentCollection:O,searchTerm:W})},[O,M,U,W]),K=(0,s.useCallback)(async e=>{X({entryUUID:e,collectionSlug:null==O?void 0:O.slug}),q("delete thread from history click",{entryUUID:e})},[null==O?void 0:O.slug,X,q]);return(0,r.jsxs)(R.ZP,{className:"flex items-center gap-x-md py-md md:px-0",children:[(0,r.jsx)(k,{featuredImage:T,type:D,title:t,href:w}),(0,r.jsxs)("div",{className:"w-full grow",children:[(0,r.jsx)(c(),{href:w,className:"group block",children:(0,r.jsxs)(R.ZP,{className:"",children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-md",children:[(0,r.jsx)(P.Z,{className:"grow",variant:"baseSemi",children:(0,r.jsx)("div",{"data-testid":"thread-title",className:"break-all transition duration-300 line-clamp-1 md:group-hover:text-super md:dark:group-hover:text-superDark",children:t})}),null!=I&&(0,r.jsx)(y.Z,{size:"small",user:I})]}),(0,r.jsx)(P.Z,{color:"light",className:"break-word text-balance mt-two line-clamp-2",children:l})]})}),(0,r.jsx)("div",{className:A?"mt-xs":"mt-sm",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(Q,{threadCount:n,threadAccess:Z,lastUpdated:i,socialInfo:b,assistant:C}),(0,r.jsxs)("div",{className:"flex items-center gap-x-xs",children:[(null==S?void 0:S.title)&&D===a.LIBRARY&&(0,r.jsx)(c(),{href:"/collections/".concat(null==S?void 0:S.slug),className:"block",children:(0,r.jsx)(R.ZP,{className:"rounded-full border px-xs",children:(0,r.jsxs)(P.Z,{variant:"tiny",className:"flex cursor-pointer select-none items-center gap-x-xs px-sm py-xs transition duration-300 hover:opacity-70",testId:"thread-collection-pill",children:[(0,r.jsx)(f.B,{unified:S.emoji,size:"tiny"}),(0,r.jsx)("div",{className:"line-clamp-1",children:S.title})]})})}),A&&!(null==S?void 0:S.title)&&(0,r.jsx)(E.Z,{testId:"add-to-collection",toolTip:B("addToCollection"),onClick:()=>G({entryUUID:_}),icon:L.r8,size:"small"}),(0,r.jsx)(j.Z,{show:A,onDelete:()=>K(_),onAddToCollection:()=>G({entryUUID:_}),onSwapCollection:()=>G({entryUUID:_}),onRemoveFromCollection:()=>z({entryUUID:_,oldCollectionUUID:O.uuid,callback:()=>{D===a.COLLECTION&&F.push("/library")}}),currentCollection:O,rwToken:N,type:D})]})]})})]})]})};var U=l(35221),M=l(13521);(n=a||(a={})).LIBRARY="library",n.COLLECTION="collection",n.DISCOVER="discover",n.SEARCH="search",n.INCOGNITO_SEARCH="incognitoSearch";let W=e=>{let{threads:t,fetchNextPage:l,hasNextPage:n=!1,showLoadingState:a=!1,showEmptyState:s=!1,type:i}=e,c=(null!=t?t:[]).map(U.gN),u=(0,o.useTranslations)("threads.main");return s&&0===c.length?(0,r.jsx)(R.ZP,{variant:"offset",className:"mt-md flex items-center justify-center rounded p-xl",children:"collection"===i?(0,r.jsx)(P.Z,{color:"light",children:u("threadsPlaceholder")}):(0,r.jsx)(P.Z,{color:"light",children:u("noThreads")})}):(0,r.jsx)(M.D,{fetchNextPage:l,hasNextPage:n,showLoadingState:a,itemsToRender:c,children:(0,r.jsx)(R.ZP,{className:"divide-y",children:c.map(e=>{var t;return(0,r.jsx)(O,{href:e.href,rwToken:e.rwToken,title:e.title,preview:e.preview,threadCount:e.threadCount,lastUpdated:e.lastUpdated,copilot:e.copilot,assistant:e.assistant,socialInfo:e.socialInfo,threadAccess:e.threadAccess,authorImage:e.authorImage,featuredImage:null!==(t=e.featuredImage)&&void 0!==t?t:null,showActionMenu:"discover"!==i,type:i,entryUUID:e.entryUUID,collection:e.collection},e.entryUUID)})})})}},22388:function(e,t,l){var n=l(97458),a=l(40853);l(52983);var r=l(25297),s=l(10107),o=l(60971);t.Z=e=>{let{textVariant:t="baseSemi",textColor:l="default",assistant:i}=e,{AssistantConfigs:c,Assistant:u}=(0,r.I)();return i&&i!=u.internet&&null!=c[i]?(0,n.jsx)(s.ZP,{children:(0,n.jsxs)(o.Z,{variant:t,color:l,className:"flex items-center gap-x-xs",children:[(0,n.jsx)(a.G,{size:"1x",icon:c[i].icon}),(0,n.jsx)("div",{children:c[i].text})]})}):null}},56934:function(e,t,l){var n=l(97458),a=l(40853),r=l(52983),s=l(50882),o=l(48121),i=l(9269),c=l(42970),u=l(10107),d=l(60971),m=l(15065),h=l(38794),g=l(51865),x=l.n(g);t.Z=e=>{let{size:t="medium",user:l,showEdit:g,onChange:v,anon:p,altText:f,defaultIcon:y=i.IL,showProBadge:j}=e,w="xs";"medium"===t?w="1x":"large"===t&&(w="2x");let N=(0,r.useCallback)(()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{var t;let l=null===(t=e.target.files)||void 0===t?void 0:t[0];if(l){let e=new FileReader;e.onload=e=>{var t;v&&v(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(l)}},e.click()},[v]);return(0,n.jsx)("div",{className:"relative",children:(0,n.jsxs)(u.ZP,{variant:"offsetPlus",className:x()("relative flex aspect-square shrink-0 items-center justify-center rounded-full",{"h-5 w-5":"small"===t,"h-8 w-8":"medium"===t,"w-[80px]":"large"===t,"border-2 border-transparent ring-1 ring-super dark:ring-superDark":j}),children:[l&&!p?(0,n.jsx)("img",{alt:null!=f?f:"User avatar",className:"h-full w-full rounded-full object-cover",src:l}):(0,n.jsx)(d.Z,{color:"light",children:(0,n.jsx)(a.G,{size:w,icon:p?c.BC:y,fixedWidth:!0})}),g&&"small"!==t&&(0,n.jsx)("div",{className:"absolute bottom-0 right-0",children:(0,n.jsx)(m.Z,{ariaLabel:"Edit avatar",variant:l?"common":"primary",size:"small",pill:!0,icon:l?s.faPenToSquare:o.r8p,onClick:N})}),j&&(0,n.jsx)("div",{className:x()("absolute top-[100%] -mt-[6px] w-[24px] bg-offset p-[1.5px] dark:bg-offsetDark",{"opacity-0":"small"===t},{"-mt-[10px] w-lg":"large"===t}),style:{clipPath:"polygon(12% 0%, 100% 0, 100% 77%, 88% 100%, 0 100%, 0% 23%)"},children:(0,n.jsx)(h.Z,{variant:"pro",size:"small",className:"w-full"})})]})})}},83777:function(e,t,l){l.d(t,{l:function(){return s}});var n=l(83427),a=l(25617),r=l(10632);let s=()=>{var e;let t=(0,a.nO)(),l=async e=>{let{pageParam:l}=e;(!l||l<1)&&(l=1);let n=(l-1)*20;return await t.emitWithAck("list_user_collections",{limit:20,offset:n})},{data:s}=(0,n.N)({enabled:!!t,queryKey:r.Xt,refetchOnReconnect:"always",queryFn:e=>{let{pageParam:t=1}=e;return l({pageParam:t})},getNextPageParam:(e,t)=>{var l;return e&&(null===(l=e[0])||void 0===l?void 0:l.has_next_page)?t.length+1:void 0}});return{collections:null!==(e=null==s?void 0:s.pages[s.pages.length-1])&&void 0!==e?e:[]}}},71728:function(e,t,l){l.d(t,{l:function(){return d}});var n=l(78931),a=l(82129),r=l(96527),s=l(25617),o=l(54007),i=l(10505),c=l(10632),u=l(67337);let d=()=>{let e=(0,n.NL)(),t=(0,s.nO)(),{searchTerm:l}=(0,i.p)(),{threadMetadata:d}=(0,o.a0)(),{clearSidebarRecentItems:m,removeItemFromSidebar:h}=(0,r.f)(),g=[u.Tb,{search_term:null!=l?l:""}],{mutate:x}=(0,a.D)({mutationFn:async()=>{if(!t)throw Error("No socket connection");await t.emitWithAck("delete_all_threads")},onMutate:async()=>{m(),await e.cancelQueries(g),await e.cancelQueries(c.Xt);let t=e.getQueryData(g),l=e.getQueryData(c.Xt);return e.setQueryData(c.Xt,e=>{let t=e.pages.map(e=>e.map(e=>({...e,thread_count:0})));return{...e,pages:t}}),e.setQueryData(g,e=>({...e,pages:[]})),{previousThreads:t,previousCollections:l}},onSettled:(t,l,n,a)=>{l?(e.setQueryData(g,a.previousThreads),e.setQueryData(c.Xt,a.previousCollections)):(e.invalidateQueries({queryKey:g}),e.invalidateQueries({queryKey:c.Xt}))}}),{mutate:v}=(0,a.D)({mutationFn:async e=>{let{entryUUID:l,callback:n}=e;if(!t)throw Error("No socket connection");null==n||n(),await t.emitWithAck("delete_thread_by_entry_uuid",l,{read_write_token:null==d?void 0:d.rwToken}),h(l)},onMutate:async t=>{let{entryUUID:l,collectionSlug:n}=t;await e.cancelQueries(g),await e.cancelQueries(c.Xt);let a=e.getQueryData(g),r=e.getQueryData(c.Xt);return e.setQueryData(g,e=>{let t=(e=e||{pages:[],pageParams:[]}).pages.map(e=>e.filter(e=>e.uuid!==l));return{...e,pages:t}}),n&&(e.setQueryData(c.Xt,e=>{let t=(e=e||{pages:[],pageParams:[]}).pages.map(e=>e.map(e=>e.slug===n?{...e,thread_count:e.thread_count-1}:e));return{...e,pages:t}}),e.setQueryData(["list_collection_threads",{collection_slug:n.slice(-22)}],e=>{let t=(e=e||{pages:[],pageParams:[]}).pages.map(e=>e.filter(e=>e.uuid!==l));return{...e,pages:t}})),{previousThreads:a,previousCollections:r}},onSettled:(t,l,n,a)=>{l?(e.setQueryData(g,a.previousThreads),e.setQueryData(c.Xt,a.previousCollections)):(e.invalidateQueries({queryKey:g}),e.invalidateQueries({queryKey:c.Xt}))}});return{deleteAllThreads:x,deleteThread:v}}},96527:function(e,t,l){l.d(t,{G:function(){return i},f:function(){return d}});var n=l(78931),a=l(13417),r=l(52983),s=l(27721),o=l(46532);let i=8,c="recentItems",u=()=>{let e=localStorage.getItem(c);return e?JSON.parse(e):[]},d=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,o.f)(),l=(0,n.NL)(),{isIncognito:d}=(0,s.Y)(),m=(0,a.a)([c],u,{enabled:e}),h=(0,r.useCallback)(e=>{d||l.setQueryData([c],function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=new URL(e.permalink,"http://example.com"),n={...e,permalink:l.pathname},a=[n,...t.filter(t=>t.id!==e.id&&t.permalink!==n.permalink)].slice(0,i);return localStorage.setItem(c,JSON.stringify(a)),a})},[l,d]),g=(0,r.useCallback)(e=>{l.setQueryData([c],function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t)return;let n=l.filter(t=>t.id!==e&&!t.permalink.endsWith(e));return localStorage.setItem(c,JSON.stringify(n)),n})},[t,l]),x=(0,r.useCallback)(()=>{l.setQueryData([c],[]),localStorage.removeItem(c)},[l]);return{...m,addItemToSidebar:h,removeItemFromSidebar:g,clearSidebarRecentItems:x}}},17683:function(e,t,l){l.d(t,{k:function(){return a}});var n=l(71485);let a=()=>{let e=(0,n.useTranslations)("shared");return{yearsAgo:e("yearsAgo"),monthAgo:e("monthAgo"),monthsAgo:e("monthsAgo"),dayAgo:e("dayAgo"),daysAgo:e("daysAgo"),hourAgo:e("hourAgo"),hoursAgo:e("hoursAgo"),minutesAgo:e("minutesAgo"),minuteAgo:e("minuteAgo"),justNow:e("justNow")}}},15116:function(e,t,l){var n=l(97458);l(52983);var a=l(60971),r=l(72596);t.Z=e=>{let{message:t,...l}=e;return(0,n.jsx)(r.Z,{title:void 0,subtitle:void 0,...l,children:(0,n.jsx)(a.Z,{variant:"section-title",className:"pb-md text-center",children:t})})}},31478:function(e,t,l){var n=l(97458),a=l(95194),r=l(40853),s=l(51987);l(52983);var o=l(96847),i=l(60971);t.Z=e=>{let{timestamp:t,layoutType:l="right",textVariant:c="tiny",textColor:u="light",translations:d={yearsAgo:"years ago",monthsAgo:"months ago",monthAgo:"month ago",daysAgo:"days ago",dayAgo:"day ago",hoursAgo:"hours ago",hourAgo:"hour ago",minutesAgo:"minutes ago",minuteAgo:"minute ago",justNow:"Just now"},textBlockProps:m}=e;if(!t)return null;let h=s.DateTime.fromISO("".concat(t,"Z")),g=(e=>{var t,l,n,a,r;let o=s.DateTime.local().diff(e,["years","months","days","hours","minutes","seconds"]).toObject(),i=null!==(t=o.years)&&void 0!==t?t:0,c=null!==(l=o.months)&&void 0!==l?l:0,u=null!==(n=o.days)&&void 0!==n?n:0,m=null!==(a=o.hours)&&void 0!==a?a:0,h=null!==(r=o.minutes)&&void 0!==r?r:0,{yearsAgo:g,monthAgo:x,monthsAgo:v,daysAgo:p,dayAgo:f,hoursAgo:y,minutesAgo:j,hourAgo:w,minuteAgo:N,justNow:k}=d;return i>=1?"".concat(Math.round(i)," ").concat(g):1===c?"1 ".concat(x):c>=1?"".concat(Math.round(c)," ").concat(v):1===u?"1 ".concat(f):u>=1?"".concat(Math.round(u)," ").concat(p):1===m?"1 ".concat(w):m>=1?"".concat(Math.round(m)," ").concat(y):1===h?"1 ".concat(N):h>=1?"".concat(Math.round(h)," ").concat(j):k})(h),x=h.toLocaleString(s.DateTime.DATETIME_FULL);return g?null!==g&&(0,n.jsx)(o.Z,{tooltipText:x,tooltipLayout:l,asChild:!0,children:(0,n.jsxs)(i.Z,{variant:c,color:u,className:"gap-x-xs flex cursor-default items-center",...m,children:[(0,n.jsx)("span",{children:(0,n.jsx)(r.G,{size:"sm",icon:a.SZw})}),(0,n.jsx)("span",{className:"truncate",children:g})]})}):null}}}]);