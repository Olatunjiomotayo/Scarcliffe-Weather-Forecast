"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8098],{29675:function(e,t,l){l.r(t),l.d(t,{default:function(){return C}});var n=l(97458),s=l(52983),i=l(2464),r=l.n(i),a=l(71485),o=l(55612),d=l(33658),c=l(62013),u=l(46696),m=l(71210),h=l(60971),x=l(98882),v=l(15065),p=l(51865),f=l.n(p);let g=e=>{var t;let{submit:l,editQueryValue:i,setEditQueryValue:r,setIsEditingQuery:p,isEditingQuery:g,isFirstResult:j}=e,y=(0,a.useTranslations)("shared"),{trackEvent:b}=(0,d.h)(),{isMobileStyle:w,isMobileUserAgent:k}=(0,c.d)(),{isFailed:C,result:U,isReadonly:_,isSnapshotRender:N}=(0,o.T)(),I=null==U?void 0:U.backend_uuid,S=null==U?void 0:U.frontend_context_uuid,D=null==U?void 0:U.query_str,E=(0,s.useCallback)(()=>{if(l){b("confirm edit query click",{entryUUID:I,newQuery:i});let e=(0,u.Mp)();l({rawQuery:i,existingEntryUUID:I,redoSearch:!0,collection:null,newFrontendContextUUID:_?e:null,existingFrontendContextUUID:_?null:S,promptSource:"user",querySource:"edit"})}},[l,b,i,I,S,_]),T=(0,s.useCallback)(()=>{r(null!=D?D:""),p(!1),b("cancel edit query click",{entryUUID:I})},[r,D,p,b,I]),Z=(0,s.useCallback)(e=>{(0,m.Wk)(e)&&!k&&(e.preventDefault(),E())},[E,k]),R=""===i,M=(null!==(t=D.length)&&void 0!==t?t:0)>200;return(0,n.jsx)("div",{className:f()({"my-md md:my-lg":!N,"my-md":N}),children:g?(0,n.jsx)("div",{className:"flex w-full",children:(0,n.jsx)("div",{className:"grow",children:(0,n.jsx)(x.Z,{isMobileUserAgent:k,isMobileStyle:w,onKeyDown:Z,autoFocus:!0,size:"large",wrapperClassName:"grow",value:i,onChange:e=>r(e.target.value),inlineEditBlock:(0,n.jsxs)("div",{className:"flex items-center gap-x-xs pl-sm",children:[(0,n.jsx)(v.Z,{text:y("cancel"),size:"small",pill:!0,onClick:T}),(0,n.jsx)(v.Z,{text:y("save"),pill:!0,variant:R?"common":"primary",size:"small",disabled:R,onClick:E})]})})})}):(0,n.jsx)(h.Z,{variant:M?"baseSemi":"entry-title",as:j?"h1":"div",className:f()("whitespace-pre-line break-words [word-break:break-word] ",{"whitespace-pre-wrap":M}),children:C?(0,n.jsx)("div",{className:"flex items-center gap-x-sm",children:(0,n.jsx)("span",{children:null!=D?D:"Something went wrong..."})}):D})})};var j=l(79743),y=l(10107);let b=r()(()=>Promise.all([l.e(8148),l.e(8567),l.e(3606),l.e(4002),l.e(5028),l.e(3769),l.e(9094),l.e(1580),l.e(8509)]).then(l.bind(l,68007)).then(e=>e.ThreadContent),{loadableGenerated:{webpack:()=>[68007]},loading:()=>(0,n.jsx)(j.a,{})}),w=r()(()=>Promise.all([l.e(8567),l.e(9094),l.e(5688)]).then(l.bind(l,35688)),{loadableGenerated:{webpack:()=>[35688]}}),k=(0,s.forwardRef)((e,t)=>{var l;let{result:i,inFlight:r,showAnimations:a=!1,isLastResult:m=!1,isFirstResult:h=!1,isSnapshotRender:x,idx:v,submit:p,onRelatedButtonClick:j,onTextSelectClick:k,showSurvey:C=!1,onBotStep:U,deleteLast:_,isReadonly:N}=e,{isMobileStyle:I}=(0,c.d)(),{trackEvent:S}=(0,d.h)(),[D,E]=(0,s.useState)(r),T=(0,s.useRef)(null),Z=(0,s.useRef)(r),[R,M]=(0,s.useState)(!1),[F,P]=(0,s.useState)(null!==(l=null==i?void 0:i.query_str)&&void 0!==l?l:""),A=(0,s.useMemo)(()=>i?(0,u.cW)(i):[],[i]),O=(null==i?void 0:i.status)==="failed",L=(null==i?void 0:i.status)==="pending",B=null!=A&&A.length>0,q=!B||"FINAL"===A[A.length-1].step_type,G=(0,s.useMemo)(()=>i?(0,u.EH)(i):null,[i]),H=(0,s.useMemo)(()=>{var e;return O?[]:null!==(e=null==i?void 0:i.media_items)&&void 0!==e?e:[]},[null==i?void 0:i.media_items,O]),W=(null==i?void 0:i.status)==="pending",z=!I&&q,Q=(0,s.useMemo)(()=>H.filter(e=>"image"===e.medium||"map"===e.medium),[H]);if((0,s.useEffect)(()=>{E(W)},[W]),(0,s.useEffect)(()=>{let e=h&&m,t=Z.current&&!D;e&&t&&q&&(()=>{let e=setTimeout(()=>{S("engaged",{})},1e4);return()=>{clearTimeout(e)}})(),Z.current=D},[D,h,q,m,S]),!i)return(0,n.jsx)("div",{});let J=Q.length>0;return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{ref:t}),(0,n.jsx)("div",{ref:T}),(0,n.jsx)(o.A,{idx:v,result:i,response:G,inFlight:D,isReadonly:N,isPending:L,hasSteps:B,isCopilot:B,mediaItems:H,filteredMediaItems:Q,isFailed:O,isFinalStep:q,isSnapshotRender:x,isLastResult:m,children:(0,n.jsx)(y.ZP,{className:f()("pb-lg",{"border-b":!m&&!x,"min-h-[54vh]":D&&m&&!x}),children:(0,n.jsxs)("div",{className:x?J?"md:grid grid-cols-12 gap-md":"":"md:grid grid-cols-12 gap-xl",children:[(0,n.jsxs)("div",{className:"col-span-8",children:[(0,n.jsx)(g,{setEditQueryValue:P,isFirstResult:h,submit:p,setIsEditingQuery:M,isEditingQuery:R,editQueryValue:F}),(0,n.jsx)(b,{onRelatedButtonClick:j,onTextSelectClick:k,showSurvey:C,onBotStep:U,deleteLast:_,localRef:T,showAnimations:a,submit:p,setIsEditingQuery:M,isEditingQuery:R,setEditQueryValue:P})]}),(0,n.jsx)("div",{className:"col-span-4",children:z&&(0,n.jsx)(w,{isStreaming:L,showAnimations:a})})]})})})]})});k.displayName="ThreadEntry";var C=k},48098:function(e,t,l){l.d(t,{j:function(){return eM}});var n=l(97458),s=l(52983),i=l(59842),r=l(2464),a=l.n(r),o=l(67262),d=l(68493),c=l(71485),u=l(55110),m=l(82835),h=l(43022),x=l(84053),v=l(1537),p=l(25617),f=l(57623),g=l(54007),j=l(85002),y=l(62013),b=l(46696),w=l(10107),k=l(15065),C=l(51865),U=l.n(C),_=l(35112),N=l(59815),I=l(77837),S=l.n(I);let D=e=>{let{left:t,width:l,lastResult:i,showStopButton:r,scrollToLatestEntry:a,showScrollButton:o,hasScrolled:C,setHasScrolled:I,existingFrontendContextUUID:D,moreThanOneResult:E,lastEntryUUID:T,isReadonly:Z}=e,R=(0,c.useTranslations)("askInput"),M=(0,c.useTranslations)("shared"),F=(0,u.useSearchParams)().get("q"),{submitQuery:P}=(0,f.e)(),A=(0,m.useRouter)(),O=(0,v.lG)(),L=(0,p.nO)(),{data:B}=(0,d.useSession)(),{inFlight:q}=(0,g.a0)(),{isMobileStyle:G}=(0,y.d)(),H=(0,s.useCallback)(e=>{let t=(0,b.Mp)();P({fork:Z,rawQuery:e.query,copilotOverride:!!O&&void 0,attachments:e.attachments,collection:null,newFrontendContextUUID:Z?t:null,existingFrontendContextUUID:Z?null:D,promptSource:"user",querySource:"followup"}),Z&&A.push("/search?q=pending&newFrontendContextUUID=".concat(t),"/search?",{shallow:!0})},[Z,P,O,D,A]),{setUserInput:W,...z}=(0,x.l)({clearInputOnSubmit:!0,onSubmit:S()(H,1e3,{leading:!0})}),Q=(0,s.useMemo)(()=>{try{if(!i)throw Error("lastResult is null");let e=(0,b.cW)(i);return null!=e&&"FINAL"!==e[e.length-1].step_type}catch(e){return!1}},[i]),J=(0,s.useCallback)(()=>{null==L||L.emit("perplexity_terminate",{entry_uuid:T})},[T,L]);return(0,s.useEffect)(()=>{""!=F&&W("")},[F,W]),t>0&&(0,n.jsx)(w.ZP,{style:{left:G?"0px":"".concat(t,"px"),width:G?"100%":"".concat(l,"px")},className:U()("pointer-events-none fixed z-10 grid-cols-12 gap-xl px-sm py-sm md:bottom-lg md:grid md:px-0",{"!hidden":Q,"bottom-[64px]":B,"bottom-0":!B}),children:(0,n.jsxs)("div",{className:"pointer-events-auto md:col-span-8",children:[(0,n.jsx)(_.M,{initial:!1,children:o&&!C&&E&&(0,n.jsx)(N.E.div,{className:"mb-2 flex justify-center",initial:{opacity:0,y:5},animate:{opacity:1,y:0,transition:{delay:1,duration:.15,ease:"easeOut"}},exit:{opacity:0,transition:{duration:.1,ease:"easeOut"}},children:(0,n.jsx)("div",{className:"inline-flex rounded-full bg-offset shadow-md dark:bg-offsetDark",children:(0,n.jsx)(k.Z,{size:"small",variant:"common",icon:j.r5,layout:"center",pill:!0,onClick:()=>{a(),I(!0)},toolTip:M("scrollToBottom")})})})}),(0,n.jsx)(h.m,{...z,isFollowUp:!0,disabled:q,placeholder:G&&q?"":R("placeholderFollowUp"),submitWillFork:Z,showStopButton:r,onStopButtonClick:J})]})})};var E=l(86863),T=l(50578),Z=l(56047),R=l(19801),M=l(65712),F=l(98521),P=l(11464),A=l(27721),O=l(18650),L=l(29675),B=l(40853),q=l(43566),G=l.n(q),H=l(68956),W=l(99407),z=l(60971),Q=e=>{let{currentCollection:t,size:l,handleCollectionChange:s,viewOnly:i}=e,r=(0,c.useTranslations)("shared");if(i&&!t)return null;let a=(0,n.jsxs)(z.Z,{variant:"small"===l?"tiny":"smallBold",color:"light",className:"flex cursor-pointer select-none items-center gap-x-xs px-sm py-xs transition duration-300 hover:opacity-70",children:[(0,n.jsx)("div",{children:(0,n.jsx)(B.G,{icon:W.r8})}),(0,n.jsx)("div",{children:r("collection")})]});return(0,n.jsx)("div",{children:t?t?(0,n.jsx)(G(),{href:"/collections/".concat(t.slug),children:(0,n.jsxs)(z.Z,{variant:"small"===l?"tiny":"smallBold",className:"flex cursor-pointer select-none items-center gap-x-xs px-sm py-xs transition duration-300 hover:opacity-70",children:[(0,n.jsx)(H.B,{unified:t.emoji,size:"tiny"}),(0,n.jsx)("span",{className:"overflow-hidden truncate text-ellipsis",children:t.title})]})}):null:(0,n.jsx)("div",{onClick:i?void 0:s,children:a})})},J=l(35546),V=l(16064),Y=l(10632),X=l(41342),$=l(83777),K=l(71728),ee=l(96527),et=l(93040),el=l(10505),en=l(17683),es=l(79877),ei=l(27668);function er(e){let{utcTimestamp:t}=e,l=function(e){let t=(0,c.useTranslations)("threads.entry.expiration"),l=+new Date,n=(0,s.useMemo)(()=>+new Date(e+"Z"),[e])-l;return n<0?null:n>864e5?t("expiresInDays",{days:Math.floor(n/864e5)}):n>36e5?t("expiresInHours",{hours:Math.floor(n/36e5)}):t("expiresInMinutes",n>6e4?{minutes:Math.floor(n/6e4)}:{minutes:1})}(t);return l?(0,n.jsxs)(z.Z,{variant:"tiny",color:"light",className:"flex cursor-default items-center gap-x-xs",children:[(0,n.jsx)(B.G,{icon:ei.yZ}),(0,n.jsx)("span",{className:"truncate",suppressHydrationWarning:!0,children:l})]}):null}var ea=l(22388),eo=l(51253),ed=l(49544),ec=()=>{let{firstResult:e,socialStats:t}=(0,g.a0)();if(!(null==e?void 0:e.backend_uuid))return(0,n.jsx)(n.Fragment,{});let l=t&&t.viewCount>0,s=t&&t.forkCount>0;return l||s?(0,n.jsxs)(w.ZP,{className:"flex items-center gap-x-sm ",children:[l&&(0,n.jsxs)(z.Z,{variant:"tiny",color:"light",className:"flex items-center gap-x-xs",children:[(0,n.jsx)(B.G,{size:"sm",fixedWidth:!0,icon:ed.Md}),(0,n.jsx)("div",{children:(0,b.uf)(t.viewCount)})]}),s&&(0,n.jsxs)(z.Z,{variant:"tiny",color:"light",className:"flex items-center gap-x-xs",children:[(0,n.jsx)(B.G,{size:"sm",fixedWidth:!0,icon:eo.MD}),(0,n.jsx)("div",{children:(0,b.uf)(t.forkCount)})]})]}):(0,n.jsx)(n.Fragment,{})},eu=l(21850),em=l(31478);let eh=s.memo(e=>{let{assistant:t,authorUsername:l,threadAccess:s,authorImage:i}=e,{threadMetadata:r}=(0,g.a0)(),a=!l,o=(0,en.k)();return(0,n.jsxs)("div",{className:"flex items-center gap-x-md",children:[!a&&(0,n.jsx)(w.ZP,{className:"rounded-full",children:(0,n.jsx)(es.Z,{image:null!=i?i:void 0,username:null!=l?l:void 0,showAvatar:!0,showCreatorLabel:!1,showEdit:!1,isCurrentUser:!1})}),null!=t&&"internet"!==t&&(0,n.jsx)(w.ZP,{className:"hidden rounded-full md:block",children:(0,n.jsx)(ea.Z,{textVariant:"smallBold",assistant:t})}),!a&&(null!=s?s:0)>=eu.uv.PUBLIC_READ&&(0,n.jsx)(ec,{}),r.expiry_time?(0,n.jsx)(er,{utcTimestamp:r.expiry_time}):(0,n.jsx)("div",{className:"hidden md:block",children:(0,n.jsx)(em.Z,{timestamp:r.updated_datetime,layoutType:"bottom",translations:o})})]})});var ex=l(78931),ev=l(99672),ep=l(90452),ef=l(87358),eg=l(32838),ej=l(46532),ey=l(97535),eb=l(82618);let ew=s.memo(e=>{var t,l;let{descriptionText:s,sharableURL:i}=e,{openModal:r}=(0,et.X)(),a=(0,ej.f)(),o=(0,v.lG)(),d=(0,ex.NL)(),{threadMetadata:u}=(0,g.a0)(),m=u.rwToken,h=u.frontendContextUUID,x=u.contextUUID,p=u.collection,f=null!==(l=null!==(t=null==p?void 0:p.access)&&void 0!==t?t:u.thread_access)&&void 0!==l?l:ey.k6,j=(0,ep.O)(),y=(0,c.useTranslations)("search.thread"),b=e=>{e!==f&&(o?null!=x&&null!=m&&j(x,e,m,e=>{d.setQueryData(["results",{frontend_context_uuid:h}],t=>{if(!t)return;let[l,...n]=t;return[{...l,thread_access:e},...n]})}):r("loginModal",{pitchMessage:{title:y("shareLogin",{threads:"Threads"}),description:y("shareDescription",{threads:"Threads",collections:"Collections"})},origin:eu.FM.SHARE_DROPDOWN}))},w=(0,eg.o)({currentAccessLevel:f,onClick:b,isCollection:!1}),k=w[f],C=f>eu.uv.PRIVATE_READ,U=w[null==p?void 0:p.access],_=(0,n.jsxs)("div",{className:"p-sm",children:[null!=p?(0,n.jsxs)("div",{children:[(0,n.jsx)(z.Z,{variant:"baseSemi",children:y("viewAccess")}),(0,n.jsxs)("div",{className:"mt-sm rounded border p-sm",children:[(0,n.jsxs)(z.Z,{variant:"smallBold",color:"super",className:" flex items-center gap-x-xs",children:[(0,n.jsx)(B.G,{icon:null==U?void 0:U.icon}),U.text]}),(0,n.jsx)(z.Z,{variant:"tiny",color:"light",children:U.label})]}),(0,n.jsx)(z.Z,{variant:"tiny",className:"my-sm",children:y("viewAccessInheritance",{collection:p.title})})]}):null!=m?(0,n.jsxs)("div",{children:[(0,n.jsx)(z.Z,{variant:"baseSemi",children:y("viewAccess")}),(0,n.jsx)(eb.Z,{choices:w})]}):null,(0,n.jsx)(ev.Z,{descriptionText:s,shareHref:i,isSharable:C,hasMounted:a,icon:null==k?void 0:k.icon})]});return(0,n.jsx)(ef.Z,{isSharable:C,hasMounted:a,shareHref:i,EditorDropDownContent:_,icon:null==k?void 0:k.icon,onClick:()=>b(eu.uv.PUBLIC_READ)})}),ek=s.memo(e=>{let{visible:t,tweetDescriptionText:l,threadSharedSlug:i}=e,r=(0,ej.f)(),[a,o]=(0,s.useState)("");(0,s.useEffect)(()=>{let{protocol:e,host:t}=window.location;o("".concat(e,"//").concat(t,"/search/").concat(i))},[i]);let d=(0,s.useMemo)(()=>encodeURIComponent(r?(0,b.RP)(decodeURIComponent(a)):""),[a,r]),c=(0,s.useMemo)(()=>null!=l?"Perplexity AI: ".concat(l):"Perplexity AI",[l]),u=(0,s.useMemo)(()=>U()("transition-all duration-300 opacity flex items-center gap-x-xs md:gap-x-0",{"opacity-0":!t,"opacity-100":t}),[t]);return(0,n.jsx)("div",{className:u,children:t&&(0,n.jsx)(ew,{descriptionText:c,sharableURL:d})})});var eC=l(44771),eU=l(80937),e_=l(4028),eN=l(33542),eI=l(38794);let eS=s.memo(e=>{var t,l,i,r,a;let{entryUUID:o,frontendContextUUID:d,collection:m,isFirstResultPending:h}=e,[x,p]=(0,s.useState)(!1),f=(0,u.useRouter)(),j=(0,ej.f)(),C=(0,v.lG)(),{collections:U}=(0,$.l)(),_=(0,T.p)(),{searchTerm:N}=(0,el.p)(),I=(0,X.J)(),{deleteThread:S}=(0,K.l)(),{openModal:D,closeModal:E}=(0,et.X)(),{refetch:R,addItemToSidebar:M}=(0,ee.f)(),{removeThreadFromCollection:P}=(0,Y.Fb)(),{isLoading:A,threadMetadata:O}=(0,g.a0)(),{trackEvent:L}=(0,Z.WS)(),q=(0,c.useTranslations)("search.thread"),H=(0,c.useTranslations)("threadItem"),W=(0,c.useTranslations)("article"),en=(0,c.useTranslations)("shared"),{allowArticleCreation:es}=(0,F.v)(),{isMobileStyle:ei}=(0,y.d)(),er=O.privacy_state===eu.Jr.INCOGNITO;(0,s.useEffect)(()=>{let e=O.title||O.first_query,t=O.thread_url_slug;_&&j&&e&&t&&!er&&(M({id:o,variant:"thread",title:e,permalink:"/search/".concat(t,"?newFrontendContextUUID=").concat(d)}),R())},[O,_,j,d,o,M,R,er]);let ea=(0,s.useCallback)(()=>{L("click back button",{})},[L]),eo=(0,s.useCallback)(()=>{L("click logo",{})},[L]),ed=(0,s.useCallback)(()=>{o&&(L("delete thread from search result page click",{entryUUID:o}),S({entryUUID:o,callback:()=>f.push("/")}))},[S,o,f,L]),ec=(0,s.useCallback)(()=>{if(C){if(0===U.length)I.listUserCollections(e=>{if(0===e.length)D("collectionCreateOrEdit",{frontendContextUUID:d,existingCollection:null,searchTerm:N});else{var t;D("collectionSelectModal",{entryUUID:o,userCollections:e,currentCollection:m,searchTerm:null!==(t=O.first_query)&&void 0!==t?t:"",frontendContextUUID:d})}});else{var e;D("collectionSelectModal",{entryUUID:o,userCollections:U,currentCollection:m,searchTerm:null!==(e=O.first_query)&&void 0!==e?e:"",frontendContextUUID:d})}}else D("loginModal",{pitchMessage:{title:q("headerLogin",{threads:"Threads"})},origin:eu.FM.COLLECTIONS})},[m,I,o,d,C,D,N,q,O.first_query,U]),em=(0,s.useCallback)(()=>{if(C){p(!0);let e=(0,b.Mp)();L("clicked convert thread to page",{oldContextUUID:O.contextUUID,newFrontendContextUUID:e});let t=new URLSearchParams({newFrontendContextUUID:e,existingResultsCacheUUID:d,existingContextBackendUUID:O.contextUUID}),l=new URL(window.location.href);l.pathname="page/new",l.search=t.toString();let n=l.toString();f.push(n)}else D("loginModal",{pitchMessage:{title:W("loginPrompt",{page:"Page"})},origin:eu.FM.THREAD_TO_ARTICLE})},[L,C,D,W,f,d,O.contextUUID,p]),ex=(!!_&&C||null!=m)&&!er,ev=(!!_&&C||O.title!=eC.i&&null!=O.title)&&!er,ep=ex&&ev;return(0,n.jsx)(w.ZP,{variant:"background",className:"sticky left-0 right-0 top-0 z-20 border-b md:mb-0 md:rounded-t-xl",children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-x-md px-md py-sm md:min-h-[53px]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-sm md:hidden",children:[(0,n.jsx)(G(),{href:"/",onClick:eo,children:(0,n.jsx)(eI.Z,{size:"small",variant:"mark"})}),(0,n.jsx)(k.Z,{variant:"common",size:"small",text:en("new"),icon:eU.r8,href:"/",onClick:ea})]}),(0,n.jsx)("div",{children:!A&&(0,n.jsx)(eh,{assistant:null!==(t=O.assistant)&&void 0!==t?t:null,authorUsername:null!==(l=O.author_username)&&void 0!==l?l:null,threadAccess:null!==(i=O.thread_access)&&void 0!==i?i:0,authorImage:null!==(r=O.author_image)&&void 0!==r?r:null,expiryTime:O.expiry_time})}),(0,n.jsxs)("div",{className:"hidden max-w-md grow items-center justify-center gap-x-xs text-center md:flex",children:[ex&&(0,n.jsx)(Q,{currentCollection:m,handleCollectionChange:ec,viewOnly:!C||!_}),ep&&(0,n.jsx)(z.Z,{variant:"smallBold",color:"light",children:(0,n.jsx)(B.G,{icon:eN.D2})}),ev&&(0,n.jsx)(eC.Z,{title:O.title||O.first_query,contextUUID:O.contextUUID,rwToken:_,frontendContextUUID:d})]}),(0,n.jsxs)("div",{className:"flex items-center gap-x-sm",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(J.Z,{show:j&&!h,onDelete:ed,onAddToCollection:ec,onSwapCollection:ec,onRemoveFromCollection:()=>{P({entryUUID:o,oldCollectionUUID:null==m?void 0:m.uuid,callback:E,frontendContextUUID:d})},currentCollection:m,rwToken:_,type:er?V.W.INCOGNITO_SEARCH:V.W.SEARCH}),es&&!ei&&!h&&!er&&(0,n.jsx)(k.Z,{text:H("convertThreadtoArticle"),size:"small",icon:e_.a_,onClick:em,testId:"thread-article-create",variant:"border",isLoading:x,disabled:x})]}),(0,n.jsx)(ek,{visible:!!O.thread_url_slug,tweetDescriptionText:O.title||O.first_query,threadSharedSlug:null!==(a=O.thread_url_slug)&&void 0!==a?a:void 0})]})]})})});var eD=e=>{var t,l,s;let{parentInfo:i}=e,r=(0,c.useTranslations)("threadItem"),a="article"===i.mode?"page":"search",o="";return"article_info"in i?o=null!==(l=null===(t=i.article_info)||void 0===t?void 0:t.title)&&void 0!==l?l:"":"query_str"in i&&(o=null!==(s=i.query_str)&&void 0!==s?s:""),(0,n.jsx)(G(),{href:"/".concat(a,"/").concat(i.thread_url_slug),children:(0,n.jsx)(w.ZP,{variant:"offset",bgHover:"offsetPlus",className:"flex justify-between rounded-lg p-md md:mt-md",children:(0,n.jsxs)("div",{className:"",children:[(0,n.jsxs)(z.Z,{color:"light",variant:"tiny",className:"mb-xs flex items-center gap-x-xs",children:[(0,n.jsx)(B.G,{icon:eo.MD}),(0,n.jsx)("div",{children:r("followupTo")})]}),(0,n.jsx)(z.Z,{variant:"section-title",color:"light",className:"break-all line-clamp-1",children:o})]})})})},eE=l(53314),eT=l(50542);let eZ=a()({loader:()=>l.e(9237).then(l.bind(l,89237)),ssr:!1},{loadableGenerated:{webpack:()=>[89237]}}),eR=a()({loader:()=>l.e(7689).then(l.bind(l,97689)),ssr:!1},{loadableGenerated:{webpack:()=>[97689]}}),eM=()=>{var e,t,l,r,a;let d=(0,T.p)(),c=(0,eE.X)(),[h,{left:x,width:j}]=(0,i.Z)(),{trackEvent:k}=(0,Z.WS)(),{thread:C,inFlight:U,inFlightLatest:_,lastResult:N,threadMetadata:I}=(0,g.a0)(),S=null===(e=C[0])||void 0===e?void 0:e.frontend_context_uuid,{isMobileStyle:B}=(0,y.d)(),{isIncognito:q}=(0,A.Y)(),{submitQuery:G,handleBotStep:H,deleteLastResult:W}=(0,f.e)(),{setAssistant:z,assistant:Q,setIsCopilot:J,gpt4Limit:V}=(0,M.h)();(0,s.useEffect)(()=>{var e,t;z(null!==(t=null===(e=C[0])||void 0===e?void 0:e.search_focus)&&void 0!==t?t:"internet"),J(C.some(e=>"copilot"===e.mode)&&!!V&&V>0)},[]),(0,s.useEffect)(()=>{var e;z(null!==(e=I.assistant)&&void 0!==e?e:Q)},[I.assistant]);let Y=q&&I.privacy_state!==eu.Jr.INCOGNITO||!q&&I.privacy_state===eu.Jr.INCOGNITO,X=(0,s.useMemo)(()=>!d&&(0,b.vl)(C)||Y,[C,d,Y]),$=0===C.length||U,K=null==N?void 0:N.backend_uuid,ee=(null==C?void 0:null===(t=C[0])||void 0===t?void 0:t.status)==="pending",et=(0,s.useCallback)(e=>{G(e)},[G]),el=(0,s.useCallback)(e=>{G(e)},[G]);!function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,u.useSearchParams)(),l=t.get("q"),n=t.get("copilot"),i=t.get("pro"),r=t.get("focus"),a=t.get("newFrontendContextUUID"),o=(0,v.lG)(),d=(0,p.nO)(),c=(0,m.useRouter)(),{setAssistant:h,setIsCopilot:x}=(0,M.h)(),{hasLoadedSettings:g,gpt4Limit:j}=(0,F.v)(),{submitQuery:y}=(0,f.e)();(0,s.useEffect)(()=>{if(o&&!g||!e||!l||a)return;let t=r&&r in P.w?r:void 0;void 0!==t&&h(t);let s=j>0&&("true"===n||"true"===i);x(s);let d=(0,b.Mp)();y({rawQuery:Array.isArray(l)?l[0]:l,assistantOverride:t,copilotOverride:s,collection:null,newFrontendContextUUID:d,existingFrontendContextUUID:null,promptSource:"user",querySource:"default_search"}),c.push("/search?q=pending&newFrontendContextUUID=".concat(d),"/search",{shallow:!0})},[g,d,a])}((0,s.useMemo)(()=>{var e;return 0===C.length||C.length>0&&(null===(e=C[0])||void 0===e||!e.backend_uuid)},[C]));let{refs:en,scrollToLatestItem:es,showScrollButton:ei,hasScrolled:er,setHasScrolled:ea,scrollToListItem:eo}=(0,R.$)({items:C,inFlight:U,inFlightLatest:_,rwToken:d}),ed=(0,s.useCallback)(e=>{eo(e.existingEntryUUID,!0),G(e)},[eo,G]),ec=(0,s.useMemo)(()=>C&&(null==N?void 0:N.status)!=="completed"&&(null==N?void 0:N.backend_uuid)!==void 0&&U,[C,null==N?void 0:N.status,null==N?void 0:N.backend_uuid,U]);return(0,s.useEffect)(()=>{(null==C?void 0:C.length)>=1&&(null==N?void 0:N.status)==="completed"&&k("thread viewed",{authorId:I.author_id,authorUsername:I.author_username,isThreadCreator:!!d})},[k]),(0,n.jsxs)(o.L.Content,{mobileHeader:!1,childrenWidth:"large",header:(0,n.jsx)(eS,{collection:null!==(r=I.collection)&&void 0!==r?r:null,entryUUID:null!==(a=null===(l=C[0])||void 0===l?void 0:l.backend_uuid)&&void 0!==a?a:null,frontendContextUUID:S,isFirstResultPending:ee}),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(O.u3,{firstResult:U?null:C[0]}),(0,n.jsx)("div",{className:"pb-[124px] pt-md md:pt-0",children:(0,n.jsxs)(w.ZP,{variant:"background",className:"relative",children:[I.parent_info&&(0,n.jsx)(eD,{parentInfo:I.parent_info}),(0,n.jsx)("div",{ref:h,children:C.map((e,t)=>{var l,i,r;let a=0===t,o=t===C.length-1;return(0,n.jsx)(s.Fragment,{children:(0,n.jsx)(E.Z,{fallback:(0,n.jsx)(eT.o,{description:null!==(l=null==e?void 0:e.text)&&void 0!==l?l:"Please try again later."}),children:(0,n.jsx)("div",{ref:en[t],children:(0,n.jsx)(L.default,{idx:t,result:e,inFlight:U,isReadonly:X,showAnimations:$&&o,submit:ed,onRelatedButtonClick:et,onTextSelectClick:el,isLastResult:o,isFirstResult:a,onBotStep:t=>H(e,t),showSurvey:!!c,deleteLast:o&&1!==C.length?()=>{var e;return W({frontendContextUUID:null===(e=C[0])||void 0===e?void 0:e.frontend_context_uuid})}:void 0})},null==e?void 0:e.backend_uuid)})},null!==(r=null!==(i=null==e?void 0:e.uuid)&&void 0!==i?i:null==e?void 0:e.backend_uuid)&&void 0!==r?r:t)})}),(0,n.jsx)(D,{left:x,width:j,lastResult:N,lastEntryUUID:K,showStopButton:ec,scrollToLatestEntry:es,showScrollButton:ei,hasScrolled:er,setHasScrolled:ea,existingFrontendContextUUID:S,moreThanOneResult:C.length>1,isReadonly:X})]})})]}),(0,n.jsxs)("div",{className:"md:hidden",children:[(0,n.jsx)(eZ,{havePrimaryButton:!1}),!U&&B&&(0,n.jsx)(eR,{})]})]})}},43022:function(e,t,l){l.d(t,{m:function(){return v}});var n=l(97458),s=l(52983),i=l(71485),r=l(93040),a=l(79631),o=l(36),d=l(10107),c=l(15065),u=l(69192),m=l(59815),h=l(43172),x=l(35112);let v=s.memo(e=>{let{showStopButton:t,onStopButtonClick:l,...v}=e,{currentOpenedModal:p}=(0,r.X)(),f=(0,i.useTranslations)("main.askInput"),g=(0,s.useCallback)(e=>{"Escape"===e.key&&t&&l&&null===p&&(e.preventDefault(),l())},[l,t,p]);return(0,s.useEffect)(()=>(document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}),[g]),(0,n.jsx)(d.ZP,{className:"w-full",children:(0,n.jsx)(u.A,{transition:{duration:.2,bounce:.2,type:"spring"},children:(0,n.jsx)(m.E.div,{layout:!0,layoutRoot:!0,className:"flex items-center gap-x-xs",children:(0,n.jsx)(h.S,{children:(0,n.jsxs)(x.M,{mode:"popLayout",initial:!1,children:[t&&(0,n.jsx)(m.E.div,{initial:{scale:.2,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.2,opacity:0},children:(0,n.jsx)(c.Z,{toolTip:f("stopGenerating"),variant:"rejecter",pill:!0,icon:o.oD,keyboardShortcut:["Esc"],onClick:l})},"stop-button"),(0,n.jsx)(m.E.div,{layout:!0,className:"grow",children:(0,n.jsx)(a.Z,{borderClass:"md:p-sm bg-offset dark:bg-offsetDark",hasShadow:!0,showFileUpload:!0,showCopilotToggle:!0,autofocus:null===p,querySource:v.submitWillFork?"fork":"followup",...v})},"ask-input")]})})})})})})},19801:function(e,t,l){l.d(t,{$:function(){return a}});var n=l(52983),s=l(46532),i=l(77837),r=l.n(i);let a=e=>{let{items:t,inFlight:l,inFlightLatest:i,rwToken:a,headerOffset:o=52}=e,[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),h=(0,s.f)(),x=(0,n.useRef)(!0),v=(0,n.useMemo)(()=>!a&&t.every(e=>"pending"!==e.status),[t,a]),p=(0,n.useMemo)(()=>t.some(e=>"pending"===e.status),[t]),[f,g]=(0,n.useState)({}),[j,y]=(0,n.useState)({}),b=(0,n.useCallback)(function(e){var t,l;let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s="number"==typeof e?null===(t=f[e])||void 0===t?void 0:t.current:null===(l=j[e])||void 0===l?void 0:l.current;if(s){let e=s.getBoundingClientRect().top+window.scrollY-o;window.scrollTo({top:e,behavior:n?"smooth":"auto"})}},[f,j,o]),w=(0,n.useCallback)(()=>{b(t.length-1)},[b,t.length]);return(0,n.useEffect)(()=>{g(e=>{let l={...e},s={...j},i=!1;return t.forEach((e,t)=>{let r=e.backend_uuid;if(l[t]&&l[t].current)s[r]=l[t];else{let e=n.createRef();l[t]=e,s[r]=e,i=!0}}),Object.keys(l).forEach(e=>{t.some((t,l)=>l===Number(e))||(delete l[Number(e)],i=!0)}),i&&y(s),i?l:e})},[t.length,j,p]),(0,n.useEffect)(()=>{if(t.length<=1||!h)return;let e=window.location.hash;if(e&&!l&&x.current){try{let t=e.slice(1);t.length>3?b(t,!1):b(Number(t),!1)}catch(e){console.error(e)}return}i&&b(t.length-1)},[l,i,v,t.length,f,j,h,b]),(0,n.useEffect)(()=>{let e=r()(()=>{var e;let l=null===(e=f[t.length-1])||void 0===e?void 0:e.current;if(l){let e=l.getBoundingClientRect().top+window.scrollY-100,t=document.body.scrollHeight>window.innerHeight,n=window.innerHeight+window.scrollY>=document.body.scrollHeight-10;if(window.scrollY>=e||!t||n)d&&m(!0),c(!1);else{if(u)return;c(!0)}}},200);return e(),window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e),e.cancel()}},[f,d,u,t.length]),{refs:f,scrollToLatestItem:w,scrollToListItem:b,showScrollButton:d&&!u,hasScrolled:u,setHasScrolled:m}}},82618:function(e,t,l){var n=l(97458);l(52983);var s=l(10107),i=l(79075);t.Z=e=>{let{choices:t,...l}=e;return(0,n.jsx)(s.ZP,{className:"mt-sm divide-y rounded md:border ",...l,children:t.map((e,t)=>(0,n.jsx)(i.s,{rounded:!1,...e},t))})}},50542:function(e,t,l){l.d(t,{o:function(){return a}});var n=l(97458),s=l(52983);let i=e=>{try{return JSON.parse(e)}catch(e){return null}},r="Please try again later.",a=s.memo(e=>{let{title:t="Sorry, something went wrong.",description:l=r,className:a,role:o,...d}=e,c=(0,s.useMemo)(()=>i(l),[l]);return c&&(l=r,console.warn("Tried to pass a JSON error description"),console.warn(c)),(0,n.jsxs)("div",{className:"mt-4 rounded-lg border-l-4 border-orange-500 bg-orange-100 p-4 text-left text-orange-700 ".concat(a),role:"alert",...d,children:[(0,n.jsx)("p",{className:"font-bold",children:t}),(0,n.jsx)("p",{children:l})]})})}}]);